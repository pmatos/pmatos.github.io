<!doctype html><html lang="it"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CReduce - it&amp;#39;s a kind of magic! - pmatos rambles</title><meta name="description" content="During my tenure as a C compiler developer working on GCC and LLVM there was an indispensable tool when it came to fixing bugs and that was C-Reduce, or its precursor delta. Turns out this magic applies well to JavaScript, so lets take a quick glance at what it is and how to use it. "><meta name="keywords" content=""><meta name="creation_Date" content="06/07/2022"><meta name="robots" content="index, follow"><meta name="author" content="Paulo Matos"><link rel="preconnect" href="https://fonts.gstatic.com/"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap"></noscript><link rel="preload" href="/css/style.css" as="style"><link rel="stylesheet" href="/css/style.css" media="all"><link rel="sitemap" type="application/rss+xml" title="RSS Feed for pmatos rambles " href="/feed.xml"><link rel="shortcut icon" href="/favicon/favicon.ico" sizes="any"><link rel="icon" type="image/svg+xml" href="/favicon/safari-pinned-tab.svg"><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:image" content="https://p.ocmatos.com /img/social/creduce-it&amp;#39;s-a-kind-of-magic! .png "><meta property="og:image:width" content="1280"><meta property="og:image:height" content="720"><meta property="og:title" content="CReduce - it&amp;#39;s a kind of magic!  - pmatos rambles "><meta property="og:description" content="During my tenure as a C compiler developer working on GCC and LLVM there was an indispensable tool when it came to fixing bugs and that was C-Reduce, or its precursor delta. Turns out this magic applies well to JavaScript, so lets take a quick glance at what it is and how to use it. "><meta property="og:url" content="https://p.ocmatos.com"><meta property="og:image:alt" content="Immagine per la condivisione sui social"><meta property="fb:admins" content=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><meta name="twitter:url" content=""><meta name="twitter:title" content="CReduce - it&amp;#39;s a kind of magic!  - pmatos rambles "><meta name="twitter:description" content="During my tenure as a C compiler developer working on GCC and LLVM there was an indispensable tool when it came to fixing bugs and that was C-Reduce, or its precursor delta. Turns out this magic applies well to JavaScript, so lets take a quick glance at what it is and how to use it. "><meta name="twitter:image:src" content="https://p.ocmatos.com /img/social/creduce-it&amp;#39;s-a-kind-of-magic! .png"><meta name="twitter:image:alt" content="pmatos rambles  logo"><link rel="manifest" href="/manifest.webmanifest"><meta name="apple-mobile-web-app-title" content="pmatos rambles"><meta name="application-name" content="pmatos rambles"><meta name="msapplication-TileColor" content="#000000"><meta name="theme-color" content="#000000"><link rel="shortcut icon" href="/favicon/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon/safari-pinned-tab.svg"><link rel="icon" type="image/png" sizes="196x196" href="/favicon/favicon-196.png"><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-square70x70logo" content="/favicon/mstile-icon-128.png"><meta name="msapplication-square150x150logo" content="/favicon/mstile-icon-270.png"><meta name="msapplication-square310x310logo" content="/favicon/mstile-icon-558.png"><meta name="msapplication-wide310x150logo" content="/favicon/mstile-icon-558-270.png"><meta name="apple-mobile-web-app-capable" content="yes"><link rel="apple-touch-icon" href="/favicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2048-2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2732-2048.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1668-2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2388-1668.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2048-1536.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1668-2224.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2224-1668.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1620-2160.png" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2160-1620.png" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1284-2778.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2778-1284.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1170-2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2532-1170.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1125-2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2436-1125.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1242-2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2688-1242.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-828-1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1792-828.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1242-2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2208-1242.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-750-1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1334-750.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-640-1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1136-640.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet"><script>if ("serviceWorker" in navigator)
            navigator.serviceWorker.register("/sw.js");</script><script type="application/ld+json">{
            "@context": "http://schema.org",
            "@type": "NewsArticle",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://p.ocmatos.com/blog/creduce-its-a-kind-of-magic.html"
            },
            "headline": "CReduce - it&amp;#39;s a kind of magic! - pmatos rambles",
            "image": [
                "https://p.ocmatos.com/img/social/creduce-it&amp;#39;s-a-kind-of-magic!.png"
            ],
            "datePublished": "Mon Feb 17 2020 00:00:00 GMT+0000 (Coordinated Universal Time)",
            "dateModified": "Mon Feb 17 2020 00:00:00 GMT+0000 (Coordinated Universal Time)",
            "author": {
                "@type": "Person",
                "name": "Paulo Matos"
            },
            "publisher": {
                "@type": "Organization",
                "name": "pmatos rambles",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://p.ocmatos.comimg/avatar.webpg"
                }
            },
            "description": "During my tenure as a C compiler developer working on GCC and LLVM there was an indispensable tool when it came to fixing bugs and that was C-Reduce, or its precursor delta. Turns out this magic applies well to JavaScript, so lets take a quick glance at what it is and how to use it."
        }</script></head><body><header><hgroup><p class="title">pmatos rambles</p><p class="motto">Programming, sports and music - oh wow - enjoy!</p><p></p></hgroup><nav><ul><li><a href="/">Home</a></li><li><a href="/about-me.html">About me</a></li><li><a href="/blog.html">Blog</a></li></ul></nav></header><article><small class="info"><time datetime="Mon Feb 17 2020 00:00:00 GMT+0000 (Coordinated Universal Time)">17 Feb 2020</time></small><h1>CReduce - it&#39;s a kind of magic!</h1><p>When I started compiler work <a href="http://delta.tigris.org/">delta</a> was all the rage. It would turn a testcase with thousands of lines into a single small one with perhaps no more than 15 crashing your compiler in exactly the same way as the original testcase. I have used and abused this tool but it turns out it could be improved. John Regehr and his team did so with <a href="https://embed.cs.utah.edu/creduce/">C-Reduce</a> (who by he way also developed <a href="https://embed.cs.utah.edu/csmith/">C-Smith</a>, but that's another store entirely).</p><p>C-Reduce takes things to another level squeezing that testcase ever farther until it's just a few bytes, and yet still crashing your compiler in the same interesting way it did before. In C and C++ this is a very important tool and its use is not <a href="https://gcc.gnu.org/wiki/A_guide_to_testcase_reduction">recommended</a> often enough. It's very important and in languages like C and C++ because the preprocessor can a seemingly small example into a behemoth of a source file and therefore reducing the testcase appropriately is extremely important. The recommendation page for <a href="https://gcc.gnu.org/bugs/">reporting GCC bugs</a> goes as far as saying:</p><blockquote><p>However, providing a minimal testcase increases the chances of getting your bug fixed. The only excuses to not send us the preprocessed sources are (i) if you've found a bug in the preprocessor, (ii) if you've reduced the testcase to a small file that doesn't include any other file or (iii) if the bug appears only when using precompiled headers.</p></blockquote><p>However, one advantage of <code>delta</code> was that it worked on any text file as opposed to C-Reduce that due its reduction strategy required the source to be C or C++. That is, until I was told I was wrong and that C-Reduce would be able to eat a large <a href="https://racket-lang.org">Racket</a> and spit out a small one. This stayed in the back of my head until present day.</p><p>Currently I am working on JavaScriptCore, which turns out to have bugs of its own as well. Due to the way these JIT compilers are designed you can go through several compiler tiers, code generations, on stack replacements and back until you find your bug. How great would it be if you could launch your compiler and the bug would reveal itself straightaway without having to wait for a breakpoint to be hit 60 times, step through 20 machine instructions and two OSR calls?</p><p>Well, that's what C-Reduce is here for. I remembered being told it worked with Racket and if it works with Racket it must work with JavaScript.</p><p>I develop on a <code>x86_64</code> but my crash is on <code>MIPS32el</code> and I can reproduce it on <code>qemu-user</code> like this:</p><pre class="language-shell"><code class="language-shell">$ /home/pmatos/roots/br-root.jsc32-mips/host/bin/qemu-mipsel <span class="token parameter variable">-L</span> <span class="token punctuation">\</span>
	/home/pmatos/roots/br-root.jsc32-mips/target ./WebKitBuild/Debug/bin/jsc <span class="token punctuation">\</span>
	load-varargs-then-inlined-call-and-exit.js 
qemu: uncaught target signal <span class="token number">4</span> <span class="token punctuation">(</span>Illegal instruction<span class="token punctuation">)</span> - core dumped</code></pre><p>The idea here is to reduce <code>load-varargs-then-inlined-call-and-exit.js</code> but keep the <code>Illegal instruction</code> error so I developed the simple reducing script:</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
/home/pmatos/roots/br-root.jsc32-mips/host/bin/qemu-mipsel <span class="token parameter variable">-L</span> <span class="token punctuation">\</span>
	/home/pmatos/roots/br-root.jsc32-mips/target /home/pmatos/dev/WebKit/WebKitBuild/Debug/bin/jsc <span class="token punctuation">\</span>
	load-varargs-then-inlined-call-and-exit.js <span class="token operator">&amp;></span> err.txt
<span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">'Illegal instruction'</span> err.txt</code></pre><p>This simply redirects all output from <code>jsc</code> into a file and checks that the file still contains the error <code>Illegal instruction</code>. This file can be as complex as you want to constrain the error you wish to reproduce. For our present situation this is enough.</p><p>Then, call C-Reduce:</p><pre class="language-shell"><code class="language-shell">$ creduce --not-c <span class="token parameter variable">--n</span> <span class="token number">16</span> ./red.sh load-varargs-then-inlined-call-and-exit.js
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&lt;</span> <span class="token number">26334</span> <span class="token operator">>=</span><span class="token operator">==</span>
running <span class="token number">16</span> interestingness tests <span class="token keyword">in</span> parallel
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&lt;</span> pass_blank :: <span class="token number">0</span> <span class="token operator">>=</span><span class="token operator">==</span>
<span class="token punctuation">(</span><span class="token number">0.6</span> %, <span class="token number">1046</span> bytes<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&lt;</span> pass_lines :: <span class="token number">0</span> <span class="token operator">>=</span><span class="token operator">==</span>
<span class="token punctuation">(</span>-0.3 %, <span class="token number">1055</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1.2</span> %, <span class="token number">1039</span> bytes<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&lt;</span> pass_lines :: <span class="token number">1</span> <span class="token operator">>=</span><span class="token operator">==</span>
<span class="token punctuation">(</span>-1.9 %, <span class="token number">1072</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">17.6</span> %, <span class="token number">867</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">20.9</span> %, <span class="token number">832</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">26.5</span> %, <span class="token number">773</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">34.8</span> %, <span class="token number">686</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.</code></pre><p>There are many arguments possible to creduce (which you can check with <code>creduce --help</code>. Here I used:</p><ul><li><code>--not-c</code>: disable C/C++ specific passes, use for source languages that are, well, not C-like;</li><li><code>--n 16</code>: use 16 cores to do the reduction, the more the merrier. If you interestingness script takes a long time to run, grab yourself a coffee;</li><li><code>./red.sh</code>: path to the interestingness script (make sure it's executable);</li><li><code>load-varargs-then-inlined-call-and-exit.js</code>: testcase to reduce (this is going to be modified in-place);</li></ul><p>After a while you'll be greeted with:</p><pre class="language-shell"><code class="language-shell"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token keyword">done</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

pass statistics:
  method pass_balanced :: curly2 worked <span class="token number">1</span> <span class="token builtin class-name">times</span> and failed <span class="token number">18</span> <span class="token builtin class-name">times</span>
  method pass_balanced :: curly-inside worked <span class="token number">1</span> <span class="token builtin class-name">times</span> and failed <span class="token number">12</span> <span class="token builtin class-name">times</span>
  method pass_clex :: rm-toks-11 worked <span class="token number">1</span> <span class="token builtin class-name">times</span> and failed <span class="token number">105</span> <span class="token builtin class-name">times</span>
  method pass_balanced :: parens-to-zero worked <span class="token number">1</span> <span class="token builtin class-name">times</span> and failed <span class="token number">25</span> <span class="token builtin class-name">times</span>
  method pass_blank :: <span class="token number">0</span> worked <span class="token number">1</span> <span class="token builtin class-name">times</span> and failed <span class="token number">0</span> <span class="token builtin class-name">times</span>
  method pass_clex :: rename-toks worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">4</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">8</span> worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">123</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">4</span> worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">123</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">10</span> worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">123</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">3</span> worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">123</span> <span class="token builtin class-name">times</span>
  method pass_indent :: regular worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">0</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">6</span> worked <span class="token number">2</span> <span class="token builtin class-name">times</span> and failed <span class="token number">123</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">2</span> worked <span class="token number">5</span> <span class="token builtin class-name">times</span> and failed <span class="token number">134</span> <span class="token builtin class-name">times</span>
  method pass_clex :: rm-tok-pattern-4 worked <span class="token number">5</span> <span class="token builtin class-name">times</span> and failed <span class="token number">784</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">0</span> worked <span class="token number">5</span> <span class="token builtin class-name">times</span> and failed <span class="token number">70</span> <span class="token builtin class-name">times</span>
  method pass_balanced :: parens-inside worked <span class="token number">6</span> <span class="token builtin class-name">times</span> and failed <span class="token number">7</span> <span class="token builtin class-name">times</span>
  method pass_clex :: rm-toks-1 worked <span class="token number">7</span> <span class="token builtin class-name">times</span> and failed <span class="token number">132</span> <span class="token builtin class-name">times</span>
  method pass_lines :: <span class="token number">1</span> worked <span class="token number">7</span> <span class="token builtin class-name">times</span> and failed <span class="token number">147</span> <span class="token builtin class-name">times</span>
  method pass_clex :: rm-toks-2 worked <span class="token number">8</span> <span class="token builtin class-name">times</span> and failed <span class="token number">116</span> <span class="token builtin class-name">times</span>

          ******** /home/pmatos/dev/WebKit/load-varargs-then-inlined-call-and-exit.js ********

<span class="token keyword">function</span> b<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span> a: a + <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-name function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> b.apply<span class="token punctuation">(</span>this, array<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-name function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
  c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
array <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">2147483647</span> <span class="token punctuation">]</span>
c<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Your test file now contains a much shorter testcase but will still crash your compiler in the same beautiful way.</p><pre class="language-shell"><code class="language-shell">$ /home/pmatos/roots/br-root.jsc32-mips/host/bin/qemu-mipsel <span class="token parameter variable">-L</span> /home/pmatos/roots/br-root.jsc32-mips/target ./WebKitBuild/Debug/bin/jsc load-varargs-then-inlined-call-and-exit.js 
qemu: uncaught target signal <span class="token number">4</span> <span class="token punctuation">(</span>Illegal instruction<span class="token punctuation">)</span> - core dumped</code></pre><p>For comparison the original file had 41 lines and 1052 bytes and the reduced file has 9 lines and 137 bytes which is an 87% reduction in size. But the big improvement here is not that the file is just smaller but that the number of paths taken by <code>jsc</code> is much smaller taking me strange to the illegal instruction without JIT compiling functions I don't need or jumping through tiers I don't care.</p><p>Of course, this would work just as well in a non cross-platform environment. I just used <code>qemu-user</code> due to the nature of my bug. The important thing is to have a testcase, and a script to ensure that at each reduction step, you keep the interestingness of the testcase - in other words, a way to reproduce the failure.</p><p>Here are a few examples I can think of as a script for reduction:</p><ul><li><code>jsc</code> crashes with a specific exit code so you create a script testing that specific exit code;</li><li><code>jsc</code> crashes with a specific output (above was <code>Illegal instruction</code>) but it could be anything else;</li><li><code>jsc</code> does not crash but generates some strange JIT code which you noticed by using <code>--dumpDisassembly=true</code>. Well, ensure in your interestingness script the exit code of <code>jsc</code> is 0, redirect the output to a file and parse for that specific JIT code block;</li></ul><p>Most cases could probably be reduced (pun-intented) to the above three items. You reduce for a specific exit code, a specific error, or a specific block of text. Or a combination of these.</p><p>In any case, if you implement your reducing script appropriately the result will be a testcase smaller than the original that passes your interestingness script - and C-Reduce will look like it is a kind of magic.</p></article><footer><div class="credit">&copy; 2025&nbsp;Paulo Matos</div><ul class="social"><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Twitter account" href="https://twitter.com/pocmatos"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path></svg></a></li><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Linkedin account" href="https://www.linkedin.com/in/pmatos/"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path>}}<rect x="4" y="4" width="16" height="16" rx="2"></rect><line x1="8" y1="11" x2="8" y2="16"></line><line x1="8" y1="8" x2="8" y2="8.01"></line><line x1="12" y1="16" x2="12" y2="11"></line><path d="M16 16v-3a2 2 0 0 0 -4 0"></path></svg></a></li><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Github account" href="https://github.com/pmatos"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg></a></li></ul></footer></body></html>