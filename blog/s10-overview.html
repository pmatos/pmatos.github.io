<!doctype html><html lang="it"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>S10 Overview - pmatos rambles</title><meta name="description" content="What is superoptimization? What is S10? Here&amp;#39;s an overview. "><meta name="keywords" content=""><meta name="creation_Date" content="06/07/2022"><meta name="robots" content="index, follow"><meta name="author" content="Paulo Matos"><link rel="preconnect" href="https://fonts.gstatic.com/"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@300;400;500;600;700;800&subset=latin-ext&display=swap"></noscript><link rel="preload" href="/css/style.css" as="style"><link rel="stylesheet" href="/css/style.css" media="all"><link rel="sitemap" type="application/rss+xml" title="RSS Feed for pmatos rambles " href="/feed.xml"><link rel="shortcut icon" href="/favicon/favicon.ico" sizes="any"><link rel="icon" type="image/svg+xml" href="/favicon/safari-pinned-tab.svg"><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:image" content="https://p.ocmatos.com /img/social/s10-overview .png "><meta property="og:image:width" content="1280"><meta property="og:image:height" content="720"><meta property="og:title" content="S10 Overview  - pmatos rambles "><meta property="og:description" content="What is superoptimization? What is S10? Here&amp;#39;s an overview. "><meta property="og:url" content="https://p.ocmatos.com"><meta property="og:image:alt" content="Immagine per la condivisione sui social"><meta property="fb:admins" content=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><meta name="twitter:url" content=""><meta name="twitter:title" content="S10 Overview  - pmatos rambles "><meta name="twitter:description" content="What is superoptimization? What is S10? Here&amp;#39;s an overview. "><meta name="twitter:image:src" content="https://p.ocmatos.com /img/social/s10-overview .png"><meta name="twitter:image:alt" content="pmatos rambles  logo"><link rel="manifest" href="/manifest.webmanifest"><meta name="apple-mobile-web-app-title" content="pmatos rambles"><meta name="application-name" content="pmatos rambles"><meta name="msapplication-TileColor" content="#000000"><meta name="theme-color" content="#000000"><link rel="shortcut icon" href="/favicon/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon/safari-pinned-tab.svg"><link rel="icon" type="image/png" sizes="196x196" href="/favicon/favicon-196.png"><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-square70x70logo" content="/favicon/mstile-icon-128.png"><meta name="msapplication-square150x150logo" content="/favicon/mstile-icon-270.png"><meta name="msapplication-square310x310logo" content="/favicon/mstile-icon-558.png"><meta name="msapplication-wide310x150logo" content="/favicon/mstile-icon-558-270.png"><meta name="apple-mobile-web-app-capable" content="yes"><link rel="apple-touch-icon" href="/favicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2048-2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2732-2048.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1668-2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2388-1668.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2048-1536.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1668-2224.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2224-1668.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1620-2160.png" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2160-1620.png" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1284-2778.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2778-1284.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1170-2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2532-1170.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1125-2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2436-1125.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1242-2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2688-1242.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-828-1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1792-828.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1242-2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-2208-1242.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-750-1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1334-750.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-640-1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/favicon/apple-splash-1136-640.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet"><script>if ("serviceWorker" in navigator)
            navigator.serviceWorker.register("/sw.js");</script><script type="application/ld+json">{
            "@context": "http://schema.org",
            "@type": "NewsArticle",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://p.ocmatos.com/blog/s10-overview.html"
            },
            "headline": "S10 Overview - pmatos rambles",
            "image": [
                "https://p.ocmatos.com/img/social/s10-overview.png"
            ],
            "datePublished": "Mon May 21 2018 00:00:00 GMT+0000 (Coordinated Universal Time)",
            "dateModified": "Mon May 21 2018 00:00:00 GMT+0000 (Coordinated Universal Time)",
            "author": {
                "@type": "Person",
                "name": "Paulo Matos"
            },
            "publisher": {
                "@type": "Organization",
                "name": "pmatos rambles",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://p.ocmatos.comimg/avatar.webpg"
                }
            },
            "description": "What is superoptimization? What is S10? Here&amp;#39;s an overview."
        }</script></head><body><header><hgroup><p class="title">pmatos rambles</p><p class="motto">Programming, sports and music - oh wow - enjoy!</p><p></p></hgroup><nav><ul><li><a href="/">Home</a></li><li><a href="/about-me.html">About me</a></li><li><a href="/blog.html">Blog</a></li></ul></nav></header><article><small class="info"><time datetime="Mon May 21 2018 00:00:00 GMT+0000 (Coordinated Universal Time)">21 May 2018</time></small><h1>S10 Overview</h1><h2>Superoptimization</h2><p>Superoptimization was introduced by H. Massalin in his paper <em>Superoptimizer: a look at the smallest program</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> back in 1987. The idea is that for every sequence of instructions for a given computer architecture and a metric, there is an infinite number of sequences which perform the same task (are semantically equivalent to the original sequence), but one of them is the best one with respect to the metric.</p><p>Take for example the instruction sequence in RV32I:</p><pre class="language-nasm"><code class="language-nasm">addi x1, zero, <span class="token number">1</span>
mv   x2, zero
add  x2, x2, x1
add  x2, x2, x1</code></pre><p>This sets the register <code>x2</code> to 2. If we choose a metric that orders programs by increasing order of size, then the best possible program is:</p><pre class="language-nasm"><code class="language-nasm">addi x2, zero, <span class="token number">2</span></code></pre><p>Now take another example in RV32IM (which includes the multiplication extension):</p><pre class="language-nasm"><code class="language-nasm">mul x1, x1, <span class="token number">2</span></code></pre><p>This doubles the value in register <code>x1</code>. Given the same metric, it is not possible to find a better program. However, if we change our metric to the number of clock cycles taken by the whole sequence of instructions and our micro-architecture takes 8 cycles for multiplications and 2 cycles for shifting then there's a better program:</p><pre class="language-nasm"><code class="language-nasm">slli x1, x1, <span class="token number">1</span></code></pre><p>Which shifts register <code>x1</code> by 1 bit to the left, in essence multiplying its value by two and taking only 2 cycles whereas the original example took 8 (under our micro-architectural assumptions).</p><p>For long sequence of instructions the state space that requires searching for the best sequence is enormous, which makes superoptimization a CPU intensive program. Research on superoptimization slowed down after the initial paper but has seen a resurgence in the last decade.</p><h2>The compiler</h2><p>Will superoptimizers replace your compiler? No!</p><p>Production compilers are highly complex pieces of software that generate very good code, under very tight time constraints. On the other hand, superoptimizers are very slow since they need to search very large state spaces and therefore can take minutes, hours or even days to find the best possible instruction sequence.</p><p>The placement of the superoptimizer in the development toolchain is up to the user but, in general, it will be placed after the compilation step picking up where the compiler left off and trying to optimize the code it generated.</p><h2>S10</h2><p>S10 was created out of the resurgence in superoptimization research mentioned earlier. <a href="https://dblp.org/pid/127/3128">Mangpo Phothilimthana</a> from UC Berkeley published in 2016 a paper<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> and technical report on Greenthumb. The initial prototype of S10 was built upon Greenthumb and once we verified the potential we decided to turn it into a commercial product -- where at this point about 15% of code comes from Mangpo's work.</p><p>Since most of the code was rewritten, including the interface between the backend architectures and the main modules, the architectures supported by Greenthumb are not supported by S10, namely <em>arm</em>, <em>llvm ir</em>, and <em>greenarrays</em>. We have therefore chosen to implement support initially for <a href="https://riscv.org">RISC-V</a>, with other architectures on the roadmap.</p><p>S10 is written completely in <a href="https://racket-lang.org">Racket</a> and implements three distinct algorithms that cooperate in a distributed setting. A symbolic<sup class="footnote-ref"><a href="#fn2" id="fnref2:1">[2:1]</a></sup>, stochastic<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> and lens<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> algorithms are distributed over several cores (or different machines) and communicate with each other through message passing finding incrementally better instruction sequences until it's proved that the best sequence has already been found.</p><p>S10 includes a statistical profiler and debugging aids to ensure that any error is found quickly and any hotspots are first to be optimized. Due to the statistical nature of some methods it is also possible to automatically tune these parameters on an architecture independent way to ensure the best possible performance from the framework.</p><p>Another area we focused on, given the long times taken to find solutions to the optimization problem was partial caching. S10 is supported by a database which uses previous found solutions to the superoptimization problem to simplify future searches.</p><h2>Superoptimization in practice</h2><p>In practice waiting for the perfect solution is not always possible or realistic, that is why S10 will incrementally provide incrementally better instruction sequences until it proves there is none better.</p><p>An interaction with S10 for the first example I mentioned in this post might look like this:</p><pre class="language-shell"><code class="language-shell">$ riscv-s10 <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">--timeout</span> <span class="token number">60</span> <span class="token parameter variable">--verbose</span> <span class="token parameter variable">--progress</span> add2.s
S10 Superoptimization Framework, by Linki Tools UG
https://linki.tools/s10

Booting up <span class="token number">8</span> cores <span class="token punctuation">(</span>stochastic <span class="token number">3</span>, lens <span class="token number">4</span>, symbolic <span class="token number">1</span><span class="token punctuation">)</span>
Input score: <span class="token number">16</span>

* stochastic found optimization <span class="token punctuation">(</span>score: <span class="token number">12</span><span class="token punctuation">)</span>

  <span class="token function">mv</span> x2, zero
  addi x2, x2, <span class="token number">1</span>
  addi x2, x2, <span class="token number">1</span>

* lens found optimization <span class="token punctuation">(</span>score: <span class="token number">4</span><span class="token punctuation">)</span>

  addi x2, zero, <span class="token number">2</span>
  
* symbolic found best

  addi x2, zero, <span class="token number">2</span>
  
Shutting down cores

Caching solution:
  addi x2, zero, <span class="token number">2</span></code></pre><p>The superoptimizer will incrementally give information (due to the <code>--progress</code> flag) about optimizations found until we can prove there's no better solution, or a timeout is reached (which in this case was set to 60 seconds with <code>--timeout</code>).</p><p>The metric for the previous example was instruction sequence size, but had our metric been performance the situation would have been similar with one exception. The metric has to be fast to execute because it is executed potentially millions of times. If a cycle accurate simulation takes a long time, then it is better to implement a fast heuristic and request the best few solutions found and run an accurate metric on those.</p><pre class="language-shell"><code class="language-shell">$ riscv-s10 <span class="token parameter variable">-j</span> <span class="token number">8</span> <span class="token parameter variable">--timeout</span> <span class="token number">20</span> <span class="token parameter variable">--verbose</span> <span class="token parameter variable">--progress</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--metric</span> speed --accurate-metric-script sim.sh --run-metric-on <span class="token number">2</span> add2.s
S10 Superoptimization Framework, by Linki Tools UG
https://linki.tools/s10

Booting up <span class="token number">8</span> cores <span class="token punctuation">(</span>stochastic <span class="token number">3</span>, lens <span class="token number">4</span>, symbolic <span class="token number">1</span><span class="token punctuation">)</span>
Input score: <span class="token number">16</span>

* stochastic found optimization <span class="token punctuation">(</span>score: <span class="token number">12</span><span class="token punctuation">)</span>

  <span class="token function">mv</span> x2, zero
  addi x2, x2, <span class="token number">1</span>
  addi x2, x2, <span class="token number">1</span>

* lens found optimization <span class="token punctuation">(</span>score: <span class="token number">4</span><span class="token punctuation">)</span>

  addi x2, zero, <span class="token number">2</span>

Timeout reached.
Shutting down cores

Best two solutions:

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token function">mv</span> x2, zero
    addi x2, x2, <span class="token number">1</span>
    addi x2, x2, <span class="token number">1</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> addi x2, zero, <span class="token number">2</span>

Running sim.sh on <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span>. Done
Running sim.sh on <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">..</span>. Done

Best solution <span class="token punctuation">(</span>sim.sh<span class="token punctuation">)</span>:

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> addi x2, zero, <span class="token number">2</span>

Caching solution:
  addi x2, zero, <span class="token number">2</span></code></pre><p>S10 in this case ran against a tight timeout and at that point since it was given a script to calculate an accurate metric (with <code>--accurate-metric-script</code>) it called it on the best two optimizations found at that point (due to <code>--run-metric-on</code>). The metric scored solution <code>[2]</code> as better and therefore that was the one which was returned and cached.</p><p>This is a simple example of what S10 can do. I have not mentioned how to extend the algorithms and internal structures, how to extend S10 to a new architecture or autotune it for better performance. I hope to touch those points on future posts.</p><p>Linki Tools is the first company to offer a commercial product for Superoptimization. Join us in superoptimizing your software! <a href="mailto:p@ocmatos.com">Contact me</a> for more information.</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Henry Massalin, Superoptimizer: a look at the smallest program, 1987 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Mangpo Phothilimthana, et al., GreenThumb: superoptimizer construction framework, 2016 <a href="#fnref2" class="footnote-backref">↩︎</a> <a href="#fnref2:1" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>Alex Aiken, et al., Stochastic superoptimization, 2013 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>Mangpo Phothilimthana, et al., Scaling up Superoptimization, 2016 <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section></article><footer><div class="credit">&copy; 2025&nbsp;Paulo Matos</div><ul class="social"><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Twitter account" href="https://twitter.com/pocmatos"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path></svg></a></li><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Linkedin account" href="https://www.linkedin.com/in/pmatos/"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path>}}<rect x="4" y="4" width="16" height="16" rx="2"></rect><line x1="8" y1="11" x2="8" y2="16"></line><line x1="8" y1="8" x2="8" y2="8.01"></line><line x1="12" y1="16" x2="12" y2="11"></line><path d="M16 16v-3a2 2 0 0 0 -4 0"></path></svg></a></li><li class="icon"><a target="_blank" rel="noopener noreferrer" title="Github account" href="https://github.com/pmatos"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg></a></li></ul></footer></body></html>